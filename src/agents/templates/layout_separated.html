<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Magazine - Separated</title>

  {# 1. íŒŒì´ì¬ ë³€ìˆ˜ ì•ˆì „í•˜ê²Œ ê°€ì ¸ì˜¤ê¸° #}
  {% set lp = (data.layout_params if data.layout_params is defined and data.layout_params else {}) %}
  {% set sp = (lp.split if lp.split is defined and lp.split else {}) %}
  {% set direction = (sp.direction | default('row')) %}
  {% set ratio = (sp.ratio | default(0.55)) %}
  {% set reverse = (sp.reverse | default(false)) %}

  {# CSS Flex ë¹„ìœ¨ ê³„ì‚° #}
  {% set dir_class = 'dir-col' if direction == 'column' else 'dir-row' %}
  {% set rev_class = 'is-reverse' if reverse else 'is-normal' %}
  
  {# 2. Director ìƒ‰ìƒ ê°€ì ¸ì˜¤ê¸° #}
  {% set ds = data.design_spec.theme if data.design_spec and data.design_spec.theme else {} %}
  {% set colors = ds.colors if ds.colors else {} %}
  {% set fonts = ds.fonts if ds.fonts else {} %}

  <style>
    :root {
      /* ğŸš¨ ê°€ë…ì„± í‘œì¤€: í° ë°°ê²½, ê²€ì€ ê¸€ì”¨ */
      --page-bg: #ffffff;
      --text-bg: #ffffff; 
      --text-main: #111111;
      --text-sub: #555555;
      
      /* ğŸ¨ [í¬ì¸íŠ¸] Directorê°€ ì •í•œ ìƒ‰ìƒì„ 'ì—‘ì„¼íŠ¸'ë¡œ ì‚¬ìš© */
      --accent: {{ colors.primary | default('#000000') }};

      /* í°íŠ¸ ì ìš© */
      --font-title: {{ fonts.title | default("serif") | safe }};
      --font-body: {{ fonts.body | default("sans-serif") | safe }};
      
      /* ë ˆì´ì•„ì›ƒ ë¹„ìœ¨ */
      --img-flex: {{ ratio }};
      --txt-flex: {{ 1.0 - ratio }};
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: var(--page-bg);
      font-family: var(--font-body);
      overflow: hidden; 
    }

    /* A4 ê·œê²© ì»¨í…Œì´ë„ˆ */
    .page {
      width: 210mm;
      height: 297mm;
      margin: 0 auto;
      position: relative;
      overflow: hidden;
      background: var(--page-bg);
      display: flex; /* Flex ë ˆì´ì•„ì›ƒ */
    }

    /* ë°©í–¥ ë° ìˆœì„œ ì„¤ì • */
    .page.dir-row { flex-direction: row; }
    .page.dir-col { flex-direction: column; }
    .page.is-reverse { flex-direction: row-reverse; }
    .page.dir-col.is-reverse { flex-direction: column-reverse; }

    /* ğŸ–¼ï¸ ì´ë¯¸ì§€ ì„¹ì…˜ */
    .image-section {
      flex: var(--img-flex);
      position: relative;
      overflow: hidden;
      height: 100%; 
      background-color: #e5e5e5; 
    }

    .image-section img {
      width: 100%;
      height: 100%;
      object-fit: cover; 
      display: block;
    }

    /* ì´ë¯¸ì§€ ë¼ë²¨ */
    .img-label {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(255, 255, 255, 0.9);
      padding: 6px 12px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #000;
      z-index: 5;
    }

    /* ğŸ“ í…ìŠ¤íŠ¸ ì„¹ì…˜ */
    .text-section {
      flex: var(--txt-flex);
      background: var(--text-bg);
      color: var(--text-main);
      padding: 14mm;
      display: flex;
      flex-direction: column;
      justify-content: center;
      overflow: hidden;
      height: 100%;
      box-sizing: border-box;
    }

    /* ì¹´í…Œê³ ë¦¬ (Kicker) */
    .kicker {
      font-family: sans-serif;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      
      /* ğŸ¨ í¬ì¸íŠ¸ ì»¬ëŸ¬ ì ìš© */
      color: var(--accent);
      margin-bottom: 20px;
      border-top: 4px solid var(--accent); /* ìƒë‹¨ êµµì€ ì„  */
      
      padding-top: 10px;
      display: inline-block;
      width: 40px;
    }

    h1 {
      font-family: var(--font-title);
      font-size: 42px;
      line-height: 1.1;
      margin: 0 0 24px 0;
      color: var(--text-main);
      word-break: keep-all; 
    }

    h3 {
      font-size: 18px;
      font-weight: 400;
      font-style: italic;
      margin: 0 0 24px 0;
      
      /* ğŸ¨ ì†Œì œëª©ì— í¬ì¸íŠ¸ ì»¬ëŸ¬ ì ìš© (ì€ì€í•œ ë©‹) */
      color: var(--accent);
      
      line-height: 1.4;
    }

    p {
      font-size: 15px; 
      line-height: 1.75;
      margin: 0;
      color: var(--text-main);
      opacity: 0.9;
      
      display: -webkit-box;
      -webkit-line-clamp: 15;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-align: justify; 
    }

    .caption {
      margin-top: 30px;
      font-size: 11px;
      color: #888;
      border-left: 1px solid #ccc;
      padding-left: 10px;
    }
  </style>
</head>

<body class="page-body">
  <div class="page {{ dir_class }} {{ rev_class }}">
    
    <div class="image-section">
      {% if images and images.main_img %}
        <img src="{{ images.main_img }}" alt="Editorial Image" />
      {% else %}
        <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; background:#eee; color:#999;">
          NO IMAGE
        </div>
      {% endif %}
      
      {% set mood = data.vision_result.metadata.mood if data.vision_result and data.vision_result.metadata else 'Collection' %}
      <div class="img-label">{{ mood }}</div>
    </div>

    <div class="text-section">
      {# Kicker #}
      {% set pr = data.get('planner_result', {}) %}
      <div class="kicker">{{ pr.get('selected_type', 'EDITORIAL') | replace('TYPE_', '') | replace('_', ' ') }}</div>

      {# Editor ì›ê³  #}
      {% set m = (data.manuscript if data.manuscript is defined and data.manuscript else None) %}
      
      {% if m %}
        <h1>{{ m.headline | default('Untitled Story') }}</h1>
        <h3>{{ m.subhead | default('') }}</h3>
        <p>{{ m.body | default('') }}</p>
        {% if m.caption %}
          <div class="caption">{{ m.caption }}</div>
        {% endif %}
      
      {% elif data.content and data.content.blocks %}
        <h1>{{ data.content.blocks[0].headline | default('Untitled') }}</h1>
        <h3>{{ data.content.blocks[0].subhead | default('') }}</h3>
        <p>{{ data.content.blocks[0].body | default('') }}</p>
      
      {% else %}
        <h1>Generating Content...</h1>
        <p>Wait a moment for the AI to write your story.</p>
      {% endif %}
    </div>

  </div>
</body>
</html>
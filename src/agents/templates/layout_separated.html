<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Magazine - Separated</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&family=Oswald:wght@400;700&family=Roboto:wght@400;700&family=Merriweather:wght@300;700&display=swap" rel="stylesheet">

  {# â–¼â–¼â–¼ [ìˆ˜ì • 1] Pythonì—ì„œ ë³´ë‚¸ 'styles'ì™€ 'split params' ê°€ì ¸ì˜¤ê¸° â–¼â–¼â–¼ #}
  {% set s = data.styles if data.styles else {} %}
  
  {# Split ë ˆì´ì•„ì›ƒ ì „ìš© íŒŒë¼ë¯¸í„° (ë°©í–¥, ë¹„ìœ¨ ë“±) #}
  {% set lp = (data.layout_params if data.layout_params is defined and data.layout_params else {}) %}
  {% set sp = (lp.split if lp.split is defined and lp.split else {}) %}
  
  {% set direction = (sp.direction | default('row')) %}
  {% set ratio = (sp.ratio | default(0.55)) %}
  {% set reverse = (sp.reverse | default(false)) %}

  {# CSS Flex í´ë˜ìŠ¤ ì„¤ì • #}
  {% set dir_class = 'dir-col' if direction == 'column' else 'dir-row' %}
  {% set rev_class = 'is-reverse' if reverse else 'is-normal' %}
  {# â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–² #}

  <style>
    :root {
      /* â–¼â–¼â–¼ [ìˆ˜ì • 2] Directorê°€ ì •í•´ì¤€ ìŠ¤íƒ€ì¼(s) ë³€ìˆ˜ ì—°ê²° â–¼â–¼â–¼ */
      
      /* ê¸°ë³¸ ë°°ê²½ ë° í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
      --page-bg: #ffffff;
      --text-bg: #ffffff; 
      
      /* í…ìŠ¤íŠ¸ ìƒ‰ìƒì€ Directorê°€ ì¤€ ê°’ (ì—†ìœ¼ë©´ ê¸°ë³¸ ê²€ì •) */
      --text-main: {{ s.color_text_main | default('#111111') }};
      --text-sub: {{ s.color_text_sub | default('#555555') }};
      
      /* ğŸ¨ í¬ì¸íŠ¸ ì»¬ëŸ¬ (Directorì˜ Primary Color) */
      /* publisher.pyì—ì„œ colors.primaryë¥¼ s.color_bgë¡œ ë§¤í•‘í•´ì„œ ë³´ëƒˆìœ¼ë¯€ë¡œ ê·¸ê±¸ ì”€ */
      --accent: {{ s.color_bg | default('#000000') }};

      /* í°íŠ¸ ì ìš© */
      --font-title: {{ s.font_title | default("serif") | safe }};
      --font-body: {{ s.font_body | default("sans-serif") | safe }};
      
      /* ë ˆì´ì•„ì›ƒ ë¹„ìœ¨ (Publisherê°€ ê³„ì‚°í•œ ê°’) */
      --img-flex: {{ ratio }};
      --txt-flex: {{ 1.0 - ratio }};
    }

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: var(--page-bg);
      font-family: var(--font-body); /* ë³¸ë¬¸ í°íŠ¸ ì ìš© */
      overflow: hidden; 
    }

    /* A4 ê·œê²© ì»¨í…Œì´ë„ˆ */
    .page {
      width: 210mm;
      height: 297mm;
      margin: 0 auto;
      position: relative;
      overflow: hidden;
      background: var(--page-bg);
      display: flex; /* Flex ë ˆì´ì•„ì›ƒ */
    }

    /* ë°©í–¥ ë° ìˆœì„œ ì„¤ì • */
    .page.dir-row { flex-direction: row; }
    .page.dir-col { flex-direction: column; }
    .page.is-reverse { flex-direction: row-reverse; }
    .page.dir-col.is-reverse { flex-direction: column-reverse; }

    /* ğŸ–¼ï¸ ì´ë¯¸ì§€ ì„¹ì…˜ */
    .image-section {
      flex: var(--img-flex);
      position: relative;
      overflow: hidden;
      height: 100%; 
      background-color: #e5e5e5; 
    }

    .image-section img {
      width: 100%;
      height: 100%;
      object-fit: cover; 
      display: block;
    }

    /* ì´ë¯¸ì§€ ë¼ë²¨ (ë¬´ë“œ í‘œì‹œ) */
    .img-label {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(255, 255, 255, 0.9);
      padding: 6px 12px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #000;
      z-index: 5;
      font-family: 'Oswald', sans-serif;
    }

    /* ğŸ“ í…ìŠ¤íŠ¸ ì„¹ì…˜ */
    .text-section {
      flex: var(--txt-flex);
      background: var(--text-bg);
      color: var(--text-main);
      padding: 14mm;
      display: flex;
      flex-direction: column;
      justify-content: center;
      overflow: hidden;
      height: 100%;
      box-sizing: border-box;
    }

    /* ì¹´í…Œê³ ë¦¬ (Kicker) */
    .kicker {
      font-family: 'Oswald', sans-serif;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      
      /* ğŸ¨ í¬ì¸íŠ¸ ì»¬ëŸ¬ ì ìš© */
      color: var(--accent);
      margin-bottom: 20px;
      border-top: 4px solid var(--accent); /* ìƒë‹¨ í¬ì¸íŠ¸ ë¼ì¸ */
      
      padding-top: 10px;
      display: inline-block;
      width: 40px;
    }

    h1 {
      font-family: var(--font-title); /* ì œëª© í°íŠ¸ ì ìš© */
      font-size: 42px;
      line-height: 1.1;
      margin: 0 0 24px 0;
      color: var(--text-main);
      word-break: keep-all; 
    }

    h3 {
      font-size: 18px;
      font-weight: 400;
      font-style: italic;
      margin: 0 0 24px 0;
      
      /* ğŸ¨ ì†Œì œëª© í¬ì¸íŠ¸ ì»¬ëŸ¬ */
      color: var(--accent);
      
      line-height: 1.4;
    }

    p {
      font-size: 15px; 
      line-height: 1.75;
      margin: 0;
      color: var(--text-main);
      opacity: 0.9;
      
      display: -webkit-box;
      -webkit-line-clamp: 15;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-align: justify; 
    }

    .caption {
      margin-top: 30px;
      font-size: 11px;
      color: #888;
      border-left: 2px solid var(--accent); /* ìº¡ì…˜ ë¼ì¸ í¬ì¸íŠ¸ */
      padding-left: 10px;
    }
  </style>
</head>

<body class="page-body">
  <div class="page {{ dir_class }} {{ rev_class }}">
    
    <div class="image-section">
      {% if images and images.main_img %}
        <img src="{{ images.main_img }}" alt="Editorial Image" />
      {% else %}
        <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; background:#eee; color:#999;">
          NO IMAGE
        </div>
      {% endif %}
      
      {% set mood = data.vision_result.metadata.mood if data.vision_result and data.vision_result.metadata else 'Collection' %}
      <div class="img-label">{{ mood }}</div>
    </div>

    <div class="text-section">
      {# Kicker #}
      {% set pr = data.get('planner_result', {}) %}
      <div class="kicker">{{ pr.get('selected_type', 'EDITORIAL') | replace('TYPE_', '') | replace('_', ' ') }}</div>

      {# Editor ì›ê³  #}
      {% set m = (data.manuscript if data.manuscript is defined and data.manuscript else None) %}
      
      {% if m %}
        <h1>{{ m.headline | default('Untitled Story') }}</h1>
        <h3>{{ m.subhead | default('') }}</h3>
        <p>{{ m.body | replace('\n', '<br>') | default('') }}</p>
        {% if m.caption %}
          <div class="caption">{{ m.caption }}</div>
        {% endif %}
      
      {% elif data.content and data.content.blocks %}
        <h1>{{ data.content.blocks[0].headline | default('Untitled') }}</h1>
        <h3>{{ data.content.blocks[0].subhead | default('') }}</h3>
        <p>{{ data.content.blocks[0].body | replace('\n', '<br>') | default('') }}</p>
      
      {% else %}
        <h1>Generating Content...</h1>
        <p>Wait a moment for the AI to write your story.</p>
      {% endif %}
    </div>

  </div>
</body>
</html>
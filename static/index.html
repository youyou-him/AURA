<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Magazine Generator</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f0f2f6; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background-color: #ff4b4b; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; }
        button:hover { background-color: #ff3333; }
        #result-area { margin-top: 30px; border: 1px solid #ddd; padding: 10px; background: white; min-height: 400px; }
        iframe { width: 100%; height: 800px; border: none; }

        /* --- [í† ê¸€ ìŠ¤ìœ„ì¹˜ CSS ì¶”ê°€ë¨] --- */
        .switch-container { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; background: #eef1f5; padding: 10px; border-radius: 5px; }
        .switch-label { font-weight: bold; color: #333; }
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #ff4b4b; }
        input:checked + .slider:before { transform: translateX(24px); }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“š AI Magazine Maker</h1>
        
        <div class="form-group">
            <label>ì œëª© (Headline)</label>
            <input type="text" id="title" value="Summer Vibes">
        </div>

        <div class="form-group">
            <label>ìŠ¤íƒ€ì¼ (Style)</label>
            <select id="style">
                <option value="Modern">Modern</option>
                <option value="Elegant">Elegant</option>
                <option value="Retro">Retro</option>
                <option value="Bold">Bold</option>
            </select>
        </div>
        <div class="switch-container">
            <span class="switch-label">ğŸ¤– AIê°€ ê¸€ ë‹¤ì‹œ ì“°ê¸° (AI Rewrite)</span>
            <label class="switch">
                <input type="checkbox" id="aiToggle" checked> <span class="slider"></span>
            </label>
        </div>
        <div class="form-group">
            <label>ë³¸ë¬¸ (Body Text)</label>
            <textarea id="request" rows="4" placeholder="ì¡ì§€ì— ë“¤ì–´ê°ˆ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.">ì´ ì‚¬ì§„ì€ ì¦ê±°ìš´ ì—¬ë¦„ íœ´ê°€ì˜ ì¶”ì–µì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.</textarea>
        </div>

        <div class="form-group">
            <label>ì‚¬ì§„ ì—…ë¡œë“œ</label>
            <input type="file" id="imageInput" accept="image/*">
        </div>

        <button onclick="generateMagazine()">ë§¤ê±°ì§„ ìƒì„± ì‹œì‘! ğŸš€</button>

        <div id="loading" style="display:none; text-align:center; margin-top:20px;">
            â³ AI ì—ì´ì „íŠ¸ íŒ€ì´ ì‘ì—… ì¤‘ì…ë‹ˆë‹¤... (ì•½ 10~20ì´ˆ ì†Œìš”)
        </div>
    </div>

    <div id="result-area" style="display:none;">
        <h3>âœ¨ ìƒì„± ê²°ê³¼</h3>
        <div id="output-frame"></div>
    </div>

    <script>
        
        // ì´ë¯¸ì§€ë¥¼ Base64ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });

        async function generateMagazine() {
            const title = document.getElementById('title').value;
            const style = document.getElementById('style').value;
            const request = document.getElementById('request').value;
            const fileInput = document.getElementById('imageInput');
            
            // [í† ê¸€ ê°’ ê°€ì ¸ì˜¤ê¸° ì¶”ê°€]
            const isGenerated = document.getElementById('aiToggle').checked;
            
            if (fileInput.files.length === 0) {
                alert("ì‚¬ì§„ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”!");
                return;
            }

            // UI ìƒíƒœ ë³€ê²½
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result-area').style.display = 'none';

            try {
                // 1. ì´ë¯¸ì§€ ë³€í™˜
                const base64Img = await toBase64(fileInput.files[0]);

                // 2. ì„œë²„ë¡œ ë³´ë‚¼ ë°ì´í„° êµ¬ì„± (server.pyì˜ Pydantic ëª¨ë¸ê³¼ ì¼ì¹˜í•´ì•¼ í•¨)
                const payload = {
                    articles: [{
                        id: "0",
                        title: title,
                        request: request,
                        style: style,
                        is_generated: isGenerated,
                        image_base64: base64Img
                    }]
                };

                // 3. FastAPI ì„œë²„ë¡œ ìš”ì²­ ì „ì†¡
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error("Server Error");

                // 4. ê²°ê³¼ HTML ë°›ì•„ì„œ í‘œì‹œ
                const htmlContent = await response.text();
                const frameContainer = document.getElementById('output-frame');
                frameContainer.innerHTML = `<iframe srcdoc='${htmlContent.replace(/'/g, "&apos;")}' sandbox="allow-scripts allow-same-origin"></iframe>`;
                
                document.getElementById('result-area').style.display = 'block';

            } catch (error) {
                alert("ì—ëŸ¬ ë°œìƒ: " + error.message);
                console.error(error);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
    </script>
</body>
</html>